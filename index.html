
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Lazy Judy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Judy">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Lazy Judy">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Lazy Judy">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lazy Judy">

    
    <link rel="alternative" href="/atom.xml" title="Lazy Judy" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Lazy Judy" title="Lazy Judy"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Lazy Judy">Lazy Judy</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/16/MapReduece-Design-Patterns/" title="MapReduece设计模式总结" itemprop="url">MapReduece设计模式总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2017-03-15T16:00:00.000Z" itemprop="datePublished"> Published 2017-03-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="概要模式"><a href="#概要模式" class="headerlink" title="概要模式"></a>概要模式</h2><h3 id="数值概要"><a href="#数值概要" class="headerlink" title="数值概要"></a>数值概要</h3><p>数值概要模式是计算数值聚合统计值的一般性模式。这种模式一般是按照键来对进行分组，并对每个分组计算一些统计值。</p>
<p>常见应用：</p>
<blockquote>
<ul>
<li>单词计数</li>
<li>记录计数<br> 例如，对特定时间间隔（每周或者每天或者每小时等）计算数据每个时间周期内的数据数量。</li>
<li>最大值或最小值计数</li>
<li>平均值、中位数、标准差</li>
</ul>
</blockquote>
<h3 id="倒排索引概要"><a href="#倒排索引概要" class="headerlink" title="倒排索引概要"></a>倒排索引概要</h3><p>倒排索引模式一般是建立一个项到标识符列表的映射。顾名思义就是建立一个索引列表。例如，搜索引擎一般需要建立的关键字到网址的列表，从而用户可以通过关键字找到与关键字相关的网页。</p>
<h3 id="计数器计数"><a href="#计数器计数" class="headerlink" title="计数器计数"></a>计数器计数</h3><p>这个模式使用 MapReduce框架自身的计数器在不产生任何输出的情况下，在map阶段计算出一个全局计数。因此，我们可以用计数器来重新实现一下“单词计数”的算法，而且用计数器来实现计数效率要高很多。需要注意的是，由于计数器是存在全局内存中的，map工作完成后所有的TaskTracker将统计结果汇总给JobTracker（一般就是namenode），所以计数器的数量过多会造成namenode内存瓶颈或者溢出，因而，计数器的数量最多不能超过100个，一般应该控制在50个以下为好。</p>
<h2 id="过滤模式"><a href="#过滤模式" class="headerlink" title="过滤模式"></a>过滤模式</h2><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><p>顾名思义就是对输入的所有行进行过滤，输出留下满足条件的行，忽略不满足条件的行。这种模式只有map没有reduce，在map中对每一行进行是否满足条件的判断，根据判断结果决定是输出（留下）该行数据还是忽略（扔掉）该行数据。</p>
<h3 id="布隆过滤"><a href="#布隆过滤" class="headerlink" title="布隆过滤"></a>布隆过滤</h3><p>布隆过滤与上面的过滤很相似，不同点在于布隆过滤中预先设定一个列表，列表中有一些值，只要输入的当前行包含其中的任意一个值就认为该行满足条件可以输出。布隆过滤仍然只有map没有reduce。</p>
<h3 id="Top-10"><a href="#Top-10" class="headerlink" title="Top 10"></a>Top 10</h3><p>Top10顾名思义就是从所有的输入行中过滤出某字段的前10名输入行。这种模式map阶段维护一个长度为10的列表，列表的长度小于10的时候向列表中直接添加，直到列表的长度等于10时，则删除列表中最小的元素并添加新元素。需要注意的是这种模式可以有多个map但只能有一个reduce，reduce从N个map输出的10N个元素中找出前10作为最终的输出。可以看出，由于只能有一个reduce所以如果取Top100甚至更多时，效率是很低的。因此这种模式只适合较小的取值。</p>
<h3 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h3><p>去重既将所有输入中某个字段重复的输入过滤掉，例如，在所有用户评论中找出所有不同的用户名。这种模式中map的输出键是map的输入值，map的输出值是null。reduece只需输出reduece的输入key即可。</p>
<h2 id="数据组织模式"><a href="#数据组织模式" class="headerlink" title="数据组织模式"></a>数据组织模式</h2><h3 id="分层结构"><a href="#分层结构" class="headerlink" title="分层结构"></a>分层结构</h3><p>该模式可将基于行的数据转换为分层的格式。<br>例如，给定一个帖子列表文件和评论列表文件，创建一个结构化的XML层次结构，嵌套的表示帖子及其相关评论。输出的形式如下：</p>
<blockquote>
<p>Posts<br>&emsp;Post<br>&emsp;&emsp;第一个帖子<br>&emsp;&emsp;Comment<br>&emsp;&emsp;&emsp;第一个帖子的第一条评论<br>&emsp;&emsp;/Comment<br>&emsp;&emsp;Comment<br>&emsp;&emsp;&emsp;第一个帖子的第二条评论<br>&emsp;&emsp;/Comment<br>&emsp;/Post<br>&emsp;Post<br>&emsp;&emsp;第二个帖子<br>&emsp;&emsp;Comment<br>&emsp;&emsp;&emsp;第二个帖子的第一条评论<br>&emsp;&emsp;/Comment<br>&emsp;&emsp;Comment<br>&emsp;&emsp;&emsp;第二个帖子的第二条评论<br>&emsp;&emsp;Comment<br>&emsp;/Post<br>Posts</p>
</blockquote>
<p>输入为两个文件，一个文件中每一行是一个帖子内容，其中有一个字段保存帖子id；另一个文件中每一行是一个评论，其中有一个字段保存与该评论对应的帖子id。</p>
<p>具体实现思路为，map以两个文件为输入，实现两个mapper类分别用于处理帖子文件和评论文件。PostMapper用于处理帖子文件，输出的key为帖子id，输出value为字母“P”+输入的value（每一行的内容）。CommentMapper用于处理评论文件，输出key为该评论对应的帖子id，输出value为字母C+输入的value。其中，字母P和C是为了在reduce中key值相同的一组值中哪些是帖子哪些是评论。由于用到两个mapper，所以main函数中需要用MultipleInput.addInputPath（）为每一个mapper指定相应的文件。reduce可以很容易的区分出帖子和与该帖子对应的评论，将他们利用函数构建成xml格式再输出即可。</p>
<h3 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h3><p>分区模式是将记录进行分类，但并不关心记录的顺序。需要注意的是必须要预先知道要分多少个分区。用一个实例来描述一下分区的用法。</p>
<blockquote>
<ul>
<li>问题一：给定一组用户信息，按照最近访问日期中的年份信息对记录进行分区，一年对应一个分区。</li>
</ul>
</blockquote>
<p>main函数需要配置成使用自定义分区器，分区器也需要配置，另外需要配置reduce的数目，每一个分区对应一个reduce。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//配置自定义分区器</span></div><div class="line">job.setPartitionerClass(LastAccessDatePartitioner.class);</div><div class="line"><span class="comment">//为分区设置最小的年份，例如文件中的用户是从2008到2011，那么就是分成4个分区，每个分区的标号就是当前年份减去最小年份</span></div><div class="line"><span class="comment">//2008对应的是标号为0的分区，2009年对应的是标号为1的分区	</span></div><div class="line">LastAccessDatePartitioner.setMinLastAccessDate(job,<span class="number">2008</span>);</div><div class="line"><span class="comment">//4个分区应该设置4个reduce</span></div><div class="line">job.setNumReduceTasks(<span class="number">4</span>);</div></pre></td></tr></table></figure>
<p>map函数的输出key是年份，输出value就是输入value。然后需要实现LastAccessDatePartitioner类，完成分区器的定义，reduce直接输出即可。</p>
<p>由于第一个例子不是特别清楚，我又在网上找个一个例子，现在对分区的理解应该是正确的了。直接上例子。</p>
<blockquote>
<ul>
<li>问题二：按年龄段找出不同年龄段的男性和女性的最高收入。</li>
</ul>
</blockquote>
<p>问题的输入如下</p>
<blockquote>
<ul>
<li>Id Name Age Gender Salary<br>1201 gopal 45 Male 50,000<br>1202 manisha 40 Female 50,000<br>1203 khalil 34 Male 30,000<br>1204 prasanth 30 Male 30,000<br>1205 kiran 20 Male 40,000<br>1206 laxmi 25 Female 35,000<br>1207 bhavya 20 Female 15,000<br>1208 reshma 19 Female 15,000<br>1209 kranthi 22 Male 22,000<br>1210 Satish 24 Male 25,000<br>1211 Krishna 25 Male 25,000<br>1212 Arshad 28 Male 20,000<br>1213 lavanya 18 Female 8,000</li>
</ul>
</blockquote>
<p>其中第一行的内容是对数据每一列含义的解释，在真实的输入文件中是没有这一行的。</p>
<p>问题期望的输出如下：</p>
<blockquote>
<ul>
<li><p>输出文件一 Part-00000<br>Female    15000<br>Male        40000</p>
</li>
<li><p>输出文件二 Part-00001<br>Female       35000<br>Male         31000</p>
</li>
<li><p>输出文件三 Part-00002<br>Female      51000<br>Male        50000</p>
</li>
</ul>
</blockquote>
<p>输出的每一个文件对应一个年龄段。</p>
<p>下面我来阐述实现的思路。首先需要明确几点：</p>
<blockquote>
<ul>
<li>分区器是在map结束以后，reduce开始之前工作的。</li>
<li>分区器分几个分区，就应该有几个reduce，所以设置reduce数量的时候要注意。</li>
<li>每个reduce产生一个输出文件，也就是分在一个区里的数据对应的输出在同一个输出文件中。</li>
</ul>
</blockquote>
<p>map阶段输出key为性别字段，输出value为输入value；接着在partition阶段将年龄小于20、年龄大于20小于30以及年龄大于30的人分别分给三个reduce；因此，第一个reduce下面的应该是年龄小于20的两组数据，一组的key是Female，一组的key是Male，以此类推其他的两个reduce下面的数据就清楚了。reduce的工作很简单就是找出每组的最大值并输出即可。附上源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.*;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.*;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.*;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.*;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.*;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.util.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PartitionerExample</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span></span></div><div class="line">&#123;</div><div class="line">   <span class="comment">//Map class</span></div><div class="line">	</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MapClass</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt;</span></div><div class="line">   &#123;</div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span></span></div><div class="line">      &#123;</div><div class="line">         <span class="keyword">try</span>&#123;</div><div class="line">            String[] str = value.toString().split(<span class="string">"\t"</span>, -<span class="number">3</span>);</div><div class="line">            String gender=str[<span class="number">3</span>];</div><div class="line">            context.write(<span class="keyword">new</span> Text(gender), <span class="keyword">new</span> Text(value));</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">catch</span>(Exception e)</div><div class="line">         &#123;</div><div class="line">            System.out.println(e.getMessage());</div><div class="line">         &#125;</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="comment">//Reducer class</span></div><div class="line">	</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReduceClass</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">IntWritable</span>&gt;</span></div><div class="line">   &#123;</div><div class="line">      <span class="keyword">public</span> <span class="keyword">int</span> max = -<span class="number">1</span>;</div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable &lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException</span></div><div class="line">      &#123;</div><div class="line">         max = -<span class="number">1</span>;</div><div class="line">			</div><div class="line">         <span class="keyword">for</span> (Text val : values)</div><div class="line">         &#123;</div><div class="line">            String [] str = val.toString().split(<span class="string">"\t"</span>, -<span class="number">3</span>);</div><div class="line">            <span class="keyword">if</span>(Integer.parseInt(str[<span class="number">4</span>])&gt;max)</div><div class="line">            max=Integer.parseInt(str[<span class="number">4</span>]);</div><div class="line">         &#125;</div><div class="line">			</div><div class="line">         context.write(<span class="keyword">new</span> Text(key), <span class="keyword">new</span> IntWritable(max));</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="comment">//Partitioner class</span></div><div class="line">	</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CaderPartitioner</span> <span class="keyword">extends</span></span></div><div class="line">   <span class="title">Partitioner</span> &lt; <span class="title">Text</span>, <span class="title">Text</span> &gt;</div><div class="line">   &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPartition</span><span class="params">(Text key, Text value, <span class="keyword">int</span> numReduceTasks)</span></span></div><div class="line">      &#123;</div><div class="line">         String[] str = value.toString().split(<span class="string">"\t"</span>);</div><div class="line">         <span class="keyword">int</span> age = Integer.parseInt(str[<span class="number">2</span>]);</div><div class="line">         </div><div class="line">         <span class="keyword">if</span>(numReduceTasks == <span class="number">0</span>)</div><div class="line">         &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         &#125;</div><div class="line">         </div><div class="line">         <span class="keyword">if</span>(age&lt;=<span class="number">20</span>)</div><div class="line">         &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">else</span> <span class="keyword">if</span>(age&gt;<span class="number">20</span> &amp;&amp; age&lt;=<span class="number">30</span>)</div><div class="line">         &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span> % numReduceTasks;</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">else</span></div><div class="line">         &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">2</span> % numReduceTasks;</div><div class="line">         &#125;</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] arg)</span> <span class="keyword">throws</span> Exception</span></div><div class="line">   &#123;</div><div class="line">      Configuration conf = getConf();</div><div class="line">		</div><div class="line">      Job job = <span class="keyword">new</span> Job(conf, <span class="string">"topsal"</span>);</div><div class="line">      job.setJarByClass(PartitionerExample.class);</div><div class="line">		</div><div class="line">      FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(arg[<span class="number">0</span>]));</div><div class="line">      FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> Path(arg[<span class="number">1</span>]));</div><div class="line">		</div><div class="line">      job.setMapperClass(MapClass.class);</div><div class="line">		</div><div class="line">      job.setMapOutputKeyClass(Text.class);</div><div class="line">      job.setMapOutputValueClass(Text.class);</div><div class="line">      </div><div class="line">      <span class="comment">//set partitioner statement</span></div><div class="line">		</div><div class="line">      job.setPartitionerClass(CaderPartitioner.class);</div><div class="line">      job.setReducerClass(ReduceClass.class);</div><div class="line">      job.setNumReduceTasks(<span class="number">3</span>);</div><div class="line">      job.setInputFormatClass(TextInputFormat.class);</div><div class="line">		</div><div class="line">      job.setOutputFormatClass(TextOutputFormat.class);</div><div class="line">      job.setOutputKeyClass(Text.class);</div><div class="line">      job.setOutputValueClass(Text.class);</div><div class="line">		</div><div class="line">      System.exit(job.waitForCompletion(<span class="keyword">true</span>)? <span class="number">0</span> : <span class="number">1</span>);</div><div class="line">      <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String ar[])</span> <span class="keyword">throws</span> Exception</span></div><div class="line">   &#123;</div><div class="line">      <span class="keyword">int</span> res = ToolRunner.run(<span class="keyword">new</span> Configuration(), <span class="keyword">new</span> PartitionerExample(),ar);</div><div class="line">      System.exit(<span class="number">0</span>);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="分箱"><a href="#分箱" class="headerlink" title="分箱"></a>分箱</h3><p>分箱模式是在map阶段对数据进行拆分，即将数据分为几类。这种模式只有map阶段。假设将数据分为n类，即有n个箱子，然后有m个mapper，由于每个mapper都有可能能会处理到这n类数据，所以每个mapper都会输出n个文件，那么一共就会输出m×n个文件。这也是这种模式的缺点所在。下面举一个实际例子说明一下这种模式的应用场景。</p>
<blockquote>
<ul>
<li>问题：给定一组论坛的帖子，根据帖子的标签，将带有hadoop、pig、hive和hbase标签的帖子分别放到4个箱子中，另外，将帖子内容中提及hadoop的帖子放到一个额外的箱子中。</li>
</ul>
</blockquote>
<p>由于不同的箱子要输出到不同的文件中，所以需要用到MultipleOutputs类。main函数中需要的操作如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//配置输出文件放在名为“bin”的目录下</span></div><div class="line">MultipleOutputs.addNameOutput(job,<span class="string">"bin"</span>,TextOutputFormat.class,Text.class,NullWritable.class);</div><div class="line"><span class="comment">//不需要reduce，所以将reduce数量设为0</span></div><div class="line">job.setNumReduceTasks(<span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>具体的实现思路其实很简单，map主要做的就是提取出每个输入帖子的标签，然后用多个if else语句来判断是否含有我们的目标标签（上面的4个标签），若含有则将这个帖子写到相应的箱子中。</p>
<h3 id="全排序"><a href="#全排序" class="headerlink" title="全排序"></a>全排序</h3><p>（这个模式没有理解好）</p>
<h3 id="混排"><a href="#混排" class="headerlink" title="混排"></a>混排</h3><p>这个模式简单来说就是将有序的数据进行打乱。打乱的方式很简单map的输出键为一个随机的数，输出值为输入值。reduce仅输出value即可。</p>
<p><strong>未完待续</strong></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/MapReduece/">MapReduece</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/14/MapReduce实现电影推荐/" title="MapReduce实现电影推荐" itemprop="url">MapReduce实现电影推荐</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2017-03-13T16:00:00.000Z" itemprop="datePublished"> Published 2017-03-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="算法概述"><a href="#算法概述" class="headerlink" title="算法概述"></a>算法概述</h1><p>算法的目标是，根据用户已经看过的电影来为用户合理推荐没有看过的电影。详细问题描述在这里 <a href="http://blog.fens.me/hadoop-mapreduce-recommend/" target="_blank" rel="external">用hadoop构建电影推荐系统</a></p>
<h2 id="算法输入格式"><a href="#算法输入格式" class="headerlink" title="算法输入格式"></a>算法输入格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1,101,5.0</div><div class="line">1,102,3.0</div><div class="line">1,103,2.5</div><div class="line">2,101,2.0</div><div class="line">2,102,2.5</div><div class="line">2,103,5.0</div><div class="line">2,104,2.0</div></pre></td></tr></table></figure>
<p>第一行中，“1”代表用户id；“101”代表电影id；“5.0”表示该用户看过这部电影，并评分为5.0。</p>
<h2 id="算法输出格式"><a href="#算法输出格式" class="headerlink" title="算法输出格式"></a>算法输出格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">1	101,44.0</div><div class="line">1	102,31.5</div><div class="line">1	103,39.0</div><div class="line">1	104,33.5</div><div class="line">1	105,15.5</div><div class="line">1	106,18.0</div><div class="line">1	107,5.0</div><div class="line">2	101,45.5</div><div class="line">2	102,32.5</div><div class="line">2	103,41.5</div><div class="line">2	104,36.0</div><div class="line">2	105,15.5</div><div class="line">2	106,20.5</div><div class="line">2	107,4.0</div></pre></td></tr></table></figure>
<p>其中，以第一行为例，“1”代表用户id；“101”代表电影id；“44.0”表示该电影的综合推荐值，这个值越大表示这个电影越值得推荐。这里我们对数据集中的所有电影都进行综合评估，没有排除掉那些用户已经看过的电影，后续可能会继续完善一下。</p>
<h1 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h1><p>我们分五个步骤来完成这件事，每一个步骤都是一个mapreduce任务，在主函数中依次调用这五个任务。首先，给出主函数代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></div><div class="line">	&#123;</div><div class="line">		Step1.run();</div><div class="line">		Step2.run();</div><div class="line">		Step3.run();</div><div class="line">		Step4.run();</div><div class="line">		Step5.run();</div><div class="line">		System.exit(<span class="number">0</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h2><p>步骤一将处理成如下结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1	101:5.0,102:3.0,103:2.5</div><div class="line">2	101:2.0,102:2.5,103:5.0,104:2.0</div><div class="line">3	107:5.0,105:4.5,104:4.0,101:2.0</div><div class="line">4	106:4.0,103:3.0,101:5.0,104:4.5</div><div class="line">5	104:4.0,105:3.5,106:4.0,101:4.0,102:3.0,103:2.0</div></pre></td></tr></table></figure>
<p>以第一行为例，意义为：用户1看了101,102,103这三部电影，分别评分为5.0,3.0,2.5。至于如何得到这个结果，我先贴出map和reduce两个函数的源码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String line=value.toString();</div><div class="line">	String[] tmpArr=line.split(<span class="string">","</span>);</div><div class="line">	context.write(<span class="keyword">new</span> IntWritable(Integer.parseInt(tmpArr[<span class="number">0</span>])), <span class="keyword">new</span> Text(tmpArr[<span class="number">1</span>]+<span class="string">":"</span>+tmpArr[<span class="number">2</span>]));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>map函数非常简单，将每一行用“，”切分成字符串数组后，以用户id为key，电影id和评分连接起来的新字符串作为值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(IntWritable key,Iterable&lt;Text&gt; values,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String result=<span class="string">""</span>;</div><div class="line">	<span class="keyword">for</span>(Text val:values)</div><div class="line">	&#123;</div><div class="line">		result+=val+<span class="string">","</span>;</div><div class="line">	&#125;</div><div class="line">	result=result.substring(<span class="number">0</span>, result.length()-<span class="number">1</span>);</div><div class="line">	context.write(key, <span class="keyword">new</span> Text(result));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>reduce函数以map的输出为输入，同样key值的map输出为同一个reduce group，所以reduce就是将key值相同的所有value拼接起来，也就有了上面的结果。</p>
<h2 id="Step2"><a href="#Step2" class="headerlink" title="Step2"></a>Step2</h2><p>步骤二以Step1的输出为输入，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">101:101	5</div><div class="line">101:102	3</div><div class="line">101:103	4</div><div class="line">101:104	4</div><div class="line">101:105	2</div><div class="line">101:106	2</div><div class="line">101:107	1</div><div class="line">102:101	3</div><div class="line">102:102	3</div><div class="line">102:103	3</div><div class="line">102:104	2</div></pre></td></tr></table></figure>
<p>以第2行为例，意义为：有三个用户既看了101电影又看了102电影。具体实现如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String line=value.toString();</div><div class="line">	String[] tmpArr1=line.split(<span class="string">"	"</span>);</div><div class="line">	String[] tmpArr=tmpArr1[<span class="number">1</span>].split(<span class="string">","</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tmpArr.length;i++)</div><div class="line">	&#123;</div><div class="line">		String Item1ID=tmpArr[i].split(<span class="string">":"</span>)[<span class="number">0</span>];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;tmpArr.length;j++)</div><div class="line">		&#123;</div><div class="line">			String Item2ID=tmpArr[j].split(<span class="string">":"</span>)[<span class="number">0</span>];</div><div class="line">			context.write(<span class="keyword">new</span> Text(Item1ID+<span class="string">":"</span>+Item2ID), <span class="keyword">new</span> IntWritable(<span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>map函数针对每一行输入，进行切分，切分后用双重for循环对电影ID进行两两组合，并将组合结果作为key输出，value为1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;IntWritable&gt; values,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> result=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(IntWritable val:values)</div><div class="line">	&#123;</div><div class="line">		result+=val.get();</div><div class="line">	&#125;</div><div class="line">	context.write(key, <span class="keyword">new</span> IntWritable(result));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>reduce函数很简单，其实就是一个按组计数的过程。</p>
<h2 id="Step3"><a href="#Step3" class="headerlink" title="Step3"></a>Step3</h2><p>步骤三以Step1的输出为输入，生成如下文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">102	2:2.5,5:3.0,1:3.0</div><div class="line">103	1:2.5,4:3.0,5:2.0,2:5.0</div><div class="line">104	3:4.0,4:4.5,5:4.0,2:2.0</div><div class="line">105	5:3.5,3:4.5</div><div class="line">106	4:4.0,5:4.0</div><div class="line">107	3:5.0</div></pre></td></tr></table></figure>
<p>应该。。。不用。。。解释。。。能看出。。。是什么意思的吧。恩，就默认大家都能看懂了吧。直接上代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String line=value.toString();</div><div class="line">	String[] tmpArr=line.split(<span class="string">"	"</span>);</div><div class="line">	String UserID=tmpArr[<span class="number">0</span>];</div><div class="line">	String[] Item2pres=tmpArr[<span class="number">1</span>].split(<span class="string">","</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;Item2pres.length;i++)</div><div class="line">	&#123;</div><div class="line">		String[] tmp=Item2pres[i].split(<span class="string">":"</span>);</div><div class="line">		context.write(<span class="keyword">new</span> Text(tmp[<span class="number">0</span>]), <span class="keyword">new</span> Text(UserID+<span class="string">":"</span>+tmp[<span class="number">1</span>]));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>map以电影id为key，用户id：评分为值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;Text&gt; values,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String result=<span class="string">""</span>;</div><div class="line">	<span class="keyword">for</span>(Text val:values)</div><div class="line">	&#123;</div><div class="line">		result+=val+<span class="string">","</span>;</div><div class="line">	&#125;</div><div class="line">	result=result.substring(<span class="number">0</span>, result.length()-<span class="number">1</span>);</div><div class="line">	context.write(key, <span class="keyword">new</span> Text(result));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>reduce就是将同一个key的value连接为一个字符串。</p>
<h2 id="Step4"><a href="#Step4" class="headerlink" title="Step4"></a>Step4</h2><p>这个步骤的任务是把Step3和Step2的输出合并为一个文件，但是重点在于是将两个文件的相应行进行合并。合并结果应该是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">101:103	4	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">101:105	2	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">101:101	5	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">101:106	2	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">101:107	1	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">101:104	4	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">101:102	3	101	1:5.0,5:4.0,4:5.0,3:2.0,2:2.0</div><div class="line">102:101	3	102	2:2.5,5:3.0,1:3.0</div><div class="line">102:102	3	102	2:2.5,5:3.0,1:3.0</div><div class="line">102:103	3	102	2:2.5,5:3.0,1:3.0</div><div class="line">102:104	2	102	2:2.5,5:3.0,1:3.0</div><div class="line">102:105	1	102	2:2.5,5:3.0,1:3.0</div><div class="line">102:106	1	102	2:2.5,5:3.0,1:3.0</div><div class="line">103:101	4	103	1:2.5,4:3.0,5:2.0,2:5.0</div><div class="line">103:102	3	103	1:2.5,4:3.0,5:2.0,2:5.0</div><div class="line">103:103	4	103	1:2.5,4:3.0,5:2.0,2:5.0</div><div class="line">103:104	3	103	1:2.5,4:3.0,5:2.0,2:5.0</div><div class="line">103:106	2	103	1:2.5,4:3.0,5:2.0,2:5.0</div><div class="line">103:105	1	103	1:2.5,4:3.0,5:2.0,2:5.0</div></pre></td></tr></table></figure>
<p>以第一行为例，意义就是：所有用户中有4个用户的既看了101电影又看了103电影，所有看了101电影的用户对它的评分如下。之所以处理成这样，是为了最后一步的矩阵计算做准备。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String line=value.toString();</div><div class="line">	String[] tmpArr=line.split(<span class="string">"	"</span>);</div><div class="line">	String[] tmpArr2=tmpArr[<span class="number">0</span>].split(<span class="string">":"</span>);</div><div class="line">	<span class="keyword">if</span>(tmpArr2.length==<span class="number">2</span>)</div><div class="line">	&#123;</div><div class="line">		context.write(<span class="keyword">new</span> Text(tmpArr2[<span class="number">0</span>]), value);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		dict.put(tmpArr[<span class="number">0</span>], line);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个步骤的特殊之处在于它的输入是两种格式不同的文件，对它们要进行不同的处理，并且要将结果统一成key和value的形式再传给reduce。map函数中用if和else来分别处理两个文件，if处理的是Step2的输出，输出的key是文件的第一个字段，value是输入的这一行文件。else处理的是Step3的输出，将这个文件每一行按键值对的方式存放再全局字典中（Java的HashMap）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;Text&gt; values,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	<span class="keyword">for</span>(Text val:values)</div><div class="line">	&#123;</div><div class="line">		String ItemID=<span class="keyword">new</span> String(key.getBytes());</div><div class="line">		context.write(val, <span class="keyword">new</span> Text(dict.get(ItemID)));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>reduce将key值相同的map输出和dit中对应的值连接起来。</p>
<h2 id="Step5"><a href="#Step5" class="headerlink" title="Step5"></a>Step5</h2><p>这个步骤应该是最复杂的了。先上个图<br><img src="http://blog.fens.me/wp-content/uploads/2013/10/alogrithm_1.jpg" alt="矩阵计算推荐结果"></p>
<p>上面的图中，左边的矩阵中的每个数值表示所有用户中既看了该行对应的电影又看了该列对应的电影的用户数量，也就是Step2中我们的计算结果,右边的列向量表示用户3对每个电影的评分，等号右边就是对每个电影的推荐值。具体实现如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String line=value.toString();</div><div class="line">	String[] tmpArr1=line.split(<span class="string">"	"</span>);</div><div class="line">	String Item=tmpArr1[<span class="number">0</span>].split(<span class="string">":"</span>)[<span class="number">1</span>];</div><div class="line">	String[] userPre2CurItems=tmpArr1[<span class="number">3</span>].split(<span class="string">","</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;userPre2CurItems.length;i++)</div><div class="line">	&#123;</div><div class="line">		String[] tmp=userPre2CurItems[i].split(<span class="string">":"</span>);</div><div class="line">		<span class="keyword">double</span> curValue=Integer.parseInt(tmpArr1[<span class="number">1</span>])*Double.parseDouble(tmp[<span class="number">1</span>]);</div><div class="line">		context.write(<span class="keyword">new</span> Text(tmp[<span class="number">0</span>]+<span class="string">"	"</span>+Item), <span class="keyword">new</span> DoubleWritable(curValue));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>map输出的key是用户id和当前评价的电影id，输出的值其实是当前评价的电影的推荐值的一部分。for循环是针对每一个用户计算，并不是针对每一个电影计算。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;DoubleWritable&gt; values,Context context)</span></span></div><div class="line">		<span class="keyword">throws</span> IOException,InterruptedException</div><div class="line">&#123;</div><div class="line">	String tmpStr=<span class="keyword">new</span> String(key.getBytes());</div><div class="line">	String[] tmp=tmpStr.split(<span class="string">"	"</span>);</div><div class="line">	<span class="keyword">double</span> result=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(DoubleWritable val:values)</div><div class="line">	&#123;</div><div class="line">		result+=val.get();</div><div class="line">	&#125;</div><div class="line">	context.write(<span class="keyword">new</span> Text(tmp[<span class="number">0</span>]), <span class="keyword">new</span> Text(tmp[<span class="number">1</span>]+<span class="string">","</span>+result));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>reduce将用户id和电影id都相同的值累加，最终输出最终结果。</p>
<p><a href="https://github.com/Lazy-Pig/MapReduceExample" target="_blank" rel="external">源码下载</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/hadoop/">hadoop</a><a href="/tags/MapReduce/">MapReduce</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/14/ubuntu下mySQL使用/" title="Ubuntu下MySQL使用" itemprop="url">Ubuntu下MySQL使用</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2016-01-13T16:00:00.000Z" itemprop="datePublished"> Published 2016-01-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="MySQL的安装与启动"><a href="#MySQL的安装与启动" class="headerlink" title="MySQL的安装与启动"></a>MySQL的安装与启动</h1><h3 id="ubuntu下命令行安装"><a href="#ubuntu下命令行安装" class="headerlink" title="ubuntu下命令行安装"></a>ubuntu下命令行安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install mysql-server mysql-client</div></pre></td></tr></table></figure>
<h3 id="启动MySQL服务器端和客户端"><a href="#启动MySQL服务器端和客户端" class="headerlink" title="启动MySQL服务器端和客户端"></a>启动MySQL服务器端和客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ /etc/init.d/mysql start</div><div class="line">$ mysql -u root -p</div></pre></td></tr></table></figure>
<h1 id="常用数据库命令"><a href="#常用数据库命令" class="headerlink" title="常用数据库命令"></a>常用数据库命令</h1><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create database <span class="built_in">test</span>;</div></pre></td></tr></table></figure>
<h3 id="查看数据库编码方式"><a href="#查看数据库编码方式" class="headerlink" title="查看数据库编码方式"></a>查看数据库编码方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show create database <span class="built_in">test</span>;</div></pre></td></tr></table></figure>
<h3 id="修改数据库编码"><a href="#修改数据库编码" class="headerlink" title="修改数据库编码"></a>修改数据库编码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; alter database <span class="built_in">test</span> character <span class="built_in">set</span> = utf8;</div><div class="line"></div><div class="line">``` bash</div><div class="line"><span class="comment">### 查看存在的数据库</span></div><div class="line"></div><div class="line">``` bash</div><div class="line">mysql&gt; show databases;</div></pre></td></tr></table></figure>
<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; drop database teat;</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Web/">Web</a><a href="/tags/MySQL/">MySQL</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/12/Linux笔记-用户管理/" title="Linux用户及文件权限管理" itemprop="url">Linux用户及文件权限管理</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2016-01-11T16:00:00.000Z" itemprop="datePublished"> Published 2016-01-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="一、用户管理"><a href="#一、用户管理" class="headerlink" title="一、用户管理"></a>一、用户管理</h1><h2 id="who"><a href="#who" class="headerlink" title="who"></a>who</h2><p>功能：查询当前主机上的用户登录情况</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>打印能打印的全部</td>
</tr>
<tr>
<td>-d</td>
<td>打印死掉的进程</td>
</tr>
<tr>
<td>-m</td>
<td>同am i,mom likes</td>
</tr>
<tr>
<td>-q</td>
<td>打印当前登录用户数及用户名</td>
</tr>
<tr>
<td>-u</td>
<td>打印当前登录用户登录信息</td>
</tr>
<tr>
<td>-r</td>
<td>打印运行等级</td>
</tr>
</tbody>
</table>
<h2 id="adduser"><a href="#adduser" class="headerlink" title="adduser"></a>adduser</h2><p>功能: 添加用户</p>
<p>用法: (sudo) adduser 新用户名</p>
<p>默认会在/home下创建一个以“新用户名”为名的文件夹</p>
<p>默认情况下新创建的用户是不具有root权限的，也不在sudo用户组，也就无法通过sudo命令临时获取root权限</p>
<h2 id="groups"><a href="#groups" class="headerlink" title="groups"></a>groups</h2><p>功能：查看用户的所属组</p>
<p>用法：groups 用户名 （输出的内容冒号之前表示用户，之后表示该用户的所属组）</p>
<p>新建用户时，如果没有指定所属组，系统会默认创建一个与新建用户名相同的组<br>用户组信息存储在/etc/group文件中，文件中一行对应一个用户组的信息，内容格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">用户组:用户组口令:GID:该用户组所包含的用户</div></pre></td></tr></table></figure>
<p>其中“用户组口令”字段为“X”表示密码不可见</p>
<h2 id="将其他用户加入sudo用户组"><a href="#将其他用户加入sudo用户组" class="headerlink" title="将其他用户加入sudo用户组"></a>将其他用户加入sudo用户组</h2><p>当使用sudo命令系统提示“用户不在sudoers文件中”时，说明该用户没有在sudo用户组里，利用usermod命令为用户添加用户组，<strong>不要修改sudoers文件！</strong></p>
<h2 id="usermod命令"><a href="#usermod命令" class="headerlink" title="usermod命令"></a>usermod命令</h2><p>使用usermod命令可以为用户添加用户组，同样使用该命令你必需有root权限，你可以直接使用root用户为其它用户添加用户组，或者用其它已经在sudo用户组的用户使用sudo命令获取权限来执行该命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ su root //或者某个已经在sudo组里的用户</div><div class="line">$ groups 要被加入到sudo组里的用户名 //查看该用户的所属组</div><div class="line">$ sudo usermod -G sudo 要被加入到sudo组里的用户名 //为该用户添加用户组sudo</div><div class="line">$ groups 要被加入到sudo组里的用户名 //再次查看该用户的所属组</div></pre></td></tr></table></figure>
<h2 id="deluser"><a href="#deluser" class="headerlink" title="deluser"></a>deluser</h2><p>功能：删除用户</p>
<p>用法： sudo deluser 用户名 –remove-home</p>
<h1 id="二、文件权限"><a href="#二、文件权限" class="headerlink" title="二、文件权限"></a>二、文件权限</h1><h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p>功能：查看文件权限</p>
<p>用法：ls -l （使用长格式列出文件）</p>
<p>显示的内容格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">文件类型权限 连接数 所有者 所属用户组 文件大小 最后修改时间 文件名</div></pre></td></tr></table></figure></p>
<p>第一个字段其实是分为两个内容，文件类型和权限。第一个字符代表文件类型，接下来的九个字符分为三组，分别表示：拥有着权限，所属组权限，其他用户权限。</p>
<p>文件类型</p>
<blockquote>
<ul>
<li>‘d’，目录</li>
<li>‘l’，软连接</li>
<li>‘b’，块设备</li>
<li>‘c’，字符设备</li>
<li>‘s’，socket</li>
<li>‘p’，管道</li>
<li>‘-‘，普通文件</li>
</ul>
</blockquote>
<p>关于文件类型，这里有一点你必需时刻牢记linux里面一切皆文件，正因为这一点才有了设备文件（/dev目录下有各种设备文件，大都跟具体的硬件设备相关）这一说，还有socket（网络套接字，具体是什么，感兴趣的用户可以自己去了解或期待实验楼的后续相关课程），和pipe(管道，这个东西很重要，我们以后将会讨论到，这里你先知道有它的存在即可)。软链接文件，链接文件是分为两种的，另一种当然是“硬链接”(硬链接不常用，具体内容不作为本课程讨论重点，而软链接等同于windows上的快捷方式,你记住这一点就够了）</p>
<p>权限</p>
<blockquote>
<ul>
<li>‘r’，允许读，值为4</li>
<li>‘w’，允许写，值为2</li>
<li>‘x’，允许执行，值为1</li>
</ul>
</blockquote>
<h3 id="ls的补充用法"><a href="#ls的补充用法" class="headerlink" title="ls的补充用法"></a>ls的补充用法</h3><p>ls -A //显示隐藏文件（隐藏文件以’.’开头）</p>
<p>ls -AsSh //显示所有文件大小，并以普通人类能看懂的方式呈现（其中小s为显示文件大小，大S为按文件大小排序）</p>
<h2 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h2><p>功能：变更文件所有者</p>
<p>用法：chown 所有者 文件名</p>
<h2 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h2><p>功能：变更文件权限</p>
<p>用法：chmod 700 文件名 //700可以换成其他数值</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux学习笔记/">Linux学习笔记</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/11/Linux笔记-环境变量与文件查找/" title="Linux的环境变量与文件查找" itemprop="url">Linux的环境变量与文件查找</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2016-01-10T16:00:00.000Z" itemprop="datePublished"> Published 2016-01-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="一、变量"><a href="#一、变量" class="headerlink" title="一、变量"></a>一、变量</h1><h2 id="变量的声明、赋值与读取"><a href="#变量的声明、赋值与读取" class="headerlink" title="变量的声明、赋值与读取"></a>变量的声明、赋值与读取</h2><p>使用declare命令创建一个变量，例如创建一个变量名为tmp的变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ declare tmp</div></pre></td></tr></table></figure>
<p>变量的赋值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ tmp=shiyanlou</div></pre></td></tr></table></figure>
<p>读取变量的值，使用echo命令和$符号（<strong>$符号用于表示引用一个变量的值</strong>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ echo $tmp</div></pre></td></tr></table></figure>
<p><strong>注意！变量名只能是英文字母,数字或者下划线，且不能以数字作为开头！</strong></p>
<h1 id="二、环境变量"><a href="#二、环境变量" class="headerlink" title="二、环境变量"></a>二、环境变量</h1><p>shell的环境变量作用于自身和它的子进程。在所有的Unix和类Unix系统中，每个进程都有其各自的环境变量设置，且默认情况下，当一个进程被创建时，处理创建过程中明确指定的话，它将继承其父进程的绝大部分环境设置。shell程序也作为一个进程运行在操作系统之上，而我们在shell中运行的大部分命令都将以shell的子进程的方式运行。</p>
<p><img src="https://dn-anything-about-doc.qbox.me/linux_base/5-2.png/logoblackfont" alt="进程演示图"></p>
<h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><p>三种环境变量相关的命令，set，env，export</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>set</td>
<td>显示当前shell所有环境变量，包括其内建环境变量（与shell外观等相关），用户自定义变量及导出的环境变量</td>
</tr>
<tr>
<td>env</td>
<td>显示与当前用户相关的环境变量，还可以让命令在指定环境中运行</td>
</tr>
<tr>
<td>export</td>
<td>显示从shell中导出成环境变量的变量，也能通过它将自定义变量导出为环境变量</td>
</tr>
</tbody>
</table>
<p>可以通过以下测试体会环境变量和普通变量的区别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ temp=shiyanlou</div><div class="line">$ echo $temp</div><div class="line"></div><div class="line">shiyanlou</div><div class="line"></div><div class="line">$ zsh    //创建一个子shell，在ubuntu中默认shell为bash</div><div class="line">$ echo $temp</div><div class="line"></div><div class="line">        //显示空</div><div class="line"></div><div class="line">$ exit  //推出子shell</div><div class="line">$ export temp   //把temp变量导出为环境变量</div><div class="line">$ zsh    //重新创建子shell</div><div class="line">$ echo $temp</div><div class="line"></div><div class="line">shiyanlou</div></pre></td></tr></table></figure>
<p><strong>!!!注意!!! 为了与普通变量区分，通常我们习惯将环境变量名设为大写</strong></p>
<p>##命令的查找路径与顺序</p>
<p>我们在hell中输入一个命令，shell是怎么知道在哪去找到这个命令然后执行的呢。这是通过环境变量PATH来进行搜索的。这个PATH里面就保存了shell中执行的命令的搜索路径。</p>
<p>查看PATH环境变量的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ echo $PATH</div></pre></td></tr></table></figure>
<p>默认情况下你会看到如下输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games</div></pre></td></tr></table></figure>
<p>通常这一类目录下放的都是可执行文件，当我们在shell中执行一个命令时，系统就会按照PATH中设定的路径按照顺序依次到目录中去查找，如果存在同名的命令，则执行先找到的那个。下面我们将练习创建一个最简单的可执行shell脚本和一个使用C语言创建的”hello world”程序。</p>
<p>创建一个shell脚本文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim hello_shell.sh</div></pre></td></tr></table></figure>
<p>在脚本中添加如下内容，保存并退出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#!/bin/zsh</div><div class="line"></div><div class="line">for ((i=0; i&lt;10; i++));do</div><div class="line">    echo &quot;hello shell&quot;</div><div class="line">done</div><div class="line"></div><div class="line">exit 0</div></pre></td></tr></table></figure>
<p>为文件添加可执行权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ chmod 755 hello_shell.sh</div></pre></td></tr></table></figure>
<p>创建一个c语言”hello world”程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim hello_world.c</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line"></div><div class="line">int main(void)</div><div class="line">&#123;</div><div class="line">    printf(&quot;hello world!\n&quot;);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用gcc生成可执行文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gcc -o hello_world hello_world.c</div></pre></td></tr></table></figure>
<p>在shiyanlou家目录创建一个mybin目录，并将上述hello_shell.sh和hello_world文件移动到其中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ mkdir mybin</div><div class="line">$ mv hello_shell.sh hello_world mybin/</div></pre></td></tr></table></figure>
<p>现在你可以在mybin目录中分别运行你刚刚创建的两个程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ cd mybin</div><div class="line">$ ./hello_shell.sh</div><div class="line">$ ./hello_world</div></pre></td></tr></table></figure>
<p>然后你回到上一级目录，也就是shiyanlou家目录，你再想运行那两个程序，会发现提示命令找不到，除非你加上命令的完整路径，但是这样不是很麻烦嘛，如何做到想使用系统命令一样执行自己创建的脚本文件或者程序呢。那就要将命令所在路径添加到PATH环境变量了。</p>
<h2 id="添加自定义路径到”PATH”环境变量"><a href="#添加自定义路径到”PATH”环境变量" class="headerlink" title="添加自定义路径到”PATH”环境变量"></a>添加自定义路径到”PATH”环境变量</h2><p>在前面我们应该注意到PATH里面的路径是以：作为分割符，所以我们可以这样添加自定义路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ PATH=$PATH:/home/shiyanlou/mybin</div></pre></td></tr></table></figure>
<p><strong>!!!注意这里一定要使用绝对路径</strong></p>
<p>现在你就可以在其他任意目录执行那两个命令了。你可能会意识到这样还并没有很好的解决问题，因为我给PATH环境变量追加了一个路径，它也只是在当前shell有效，我一旦退出终端，再打开就会发现又失效了。有没有方法让添加的环境变量全局有效又或者每次启动shell时自动执行上面添加自定义路径到PATH的命令了。下面我们就来说说后一种方式——让它自动执行。</p>
<p>在每个用户的家目录中有一个shell每次启动时会默认执行一个配置脚本，以初始化环境，包括添加一些用户自定义环境变量等等。zsh的配置文件是.zshrc，相应bash的配置文件为.bashrc。它们在etc下还都有一个或多个全局的配置文件，不过我们一般只修改用户目录下的配置文件。</p>
<p>我们可以简单的使用下面命令直接添加内容到.zshrc中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ echo &quot;PATH=$PATH:/home/shiyanlou/mybin&quot; &gt;&gt; .zshrc</div></pre></td></tr></table></figure>
<p>上述命令中 <strong>&gt;&gt;表示将标准输出以追加的方式重定向到一个文件中</strong>，注意前面用到的 <strong>&gt;是以覆盖的方式重定向到一个文件中</strong>，使用的时候一定要注意分辨。在指定文件不存在的情况下都会创建新的文件</p>
<p>##修改和删除已有的变量</p>
<p>###变量的修改</p>
<p>变量的修改有以下几种方式:</p>
<table>
<thead>
<tr>
<th>变量设置方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>${变量名#匹配字串}</td>
<td>从头向后开始匹配，删除符合匹配字串的最短数据</td>
</tr>
<tr>
<td>${变量名##匹配字串}</td>
<td>从头向后开始匹配，删除符合匹配字串的最长数据</td>
</tr>
<tr>
<td>${变量名%匹配字串}</td>
<td>从尾向前开始匹配，删除符合匹配字串的最短数据</td>
</tr>
<tr>
<td>${变量名%%匹配字串}</td>
<td>从尾向前开始匹配，删除符合匹配字串的最长数据</td>
</tr>
<tr>
<td>${变量名/旧的字串/新的字串}</td>
<td>将符合旧字串的第一个字串替换为新的字串</td>
</tr>
<tr>
<td>${变量名//旧的字串/新的字串}</td>
<td>比如要修改我们前面添加到PATH的环境变量：</td>
</tr>
</tbody>
</table>
<p>比如修改我们前面添加到PATH的环境变量</p>
<p>为了避免操作失误导致命令找不到，我们先将PATH赋值给一个新的自定义变量path将符合旧字串的全部字串替换为新的字串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ path=$PATH</div><div class="line">$ echo $path</div><div class="line">$ path=$&#123;path%/home/shiyanlou/mybin&#125;</div><div class="line"># 或使用通配符,*表示任意多个任意字符</div><div class="line">$ path=$&#123;path%*/mybin&#125;</div></pre></td></tr></table></figure>
<h3 id="变量删除"><a href="#变量删除" class="headerlink" title="变量删除"></a>变量删除</h3><p>可以使用unset命令删除一个环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ unset temp</div></pre></td></tr></table></figure>
<h2 id="如何让环境变量立即生效"><a href="#如何让环境变量立即生效" class="headerlink" title="如何让环境变量立即生效"></a>如何让环境变量立即生效</h2><p>在上面我们在shell中修改了一个配置脚本文件之后（比如zsh的配置文件home目录下的.zshrc），每次都要退出终端重新打开甚至重启主机之后其才能生效，很是麻烦，我们可以使用source命令来让其立即生效。</p>
<p>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ source .zshrc</div></pre></td></tr></table></figure>
<p>source命令还有一个别名就是.，注意与表示当前路径的那个点区分开，虽然形式一样，但作用和使用方式一样，上面的命令如果替换成.的方式就该是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . ./.zshrc</div></pre></td></tr></table></figure>
<p>注意第一个点后面有一个空格，而且后面的文件必须指定完整的绝对或相对路径名，source则不需要</p>
<h1 id="三、搜索文件"><a href="#三、搜索文件" class="headerlink" title="三、搜索文件"></a>三、搜索文件</h1><p>与搜索相关的命令常用的有如下几个whereis,which,find,locate</p>
<h2 id="whereis简单快速"><a href="#whereis简单快速" class="headerlink" title="whereis简单快速"></a>whereis简单快速</h2><p>很快，它快是因为它并没有从硬盘老老实实挨个去找，而是直接从数据库中查询。whereis只能搜索二进制文件(-b)，man帮助文件(-m)和源代码文件(-s)。</p>
<h2 id="locate快而全"><a href="#locate快而全" class="headerlink" title="locate快而全"></a>locate快而全</h2><p>查找/etc下所有以sh开头的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ locate /etc/sh</div></pre></td></tr></table></figure>
<p><strong>注意,它不只是在etc目录下查找并会自动递归子目录进行查找</strong></p>
<p>查找/usr/share/下所有jpg文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ locate /usr/share/\*.jpg</div></pre></td></tr></table></figure>
<p><strong>注意要添加*号前面的反斜杠转义，否则会无法找到</strong></p>
<p>如果想只统计数目可以加上-c参数，-i参数可以忽略大小写进行查找，whereis的-b,-m，-s同样可以是使用</p>
<h2 id="which小而精"><a href="#which小而精" class="headerlink" title="which小而精"></a>which小而精</h2><p>which本身是shell内建的一个命令，我们通常使用which来确定是否安装了某个指定的软件，因为它只从PATH环境变量指定的路径中去搜索命令</p>
<h2 id="find精而细"><a href="#find精而细" class="headerlink" title="find精而细"></a>find精而细</h2><p>find应该是这几个命令中最强大的了，它不但可以通过文件类型、文件名进行查找而且可以根据文件的属性（如文件的时间戳，文件的权限等）进行搜索。find命令强大到，要把它将明白至少需要单独好几节课程才行，我们这里就只介绍一些常用的内容</p>
<p>在指定目录下搜索指定文件名的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ find /etc/ -name interfaces</div></pre></td></tr></table></figure>
<p><strong>注意find命令的路径是作为第一个参数的， 基本命令格式为 find [path] [option] [action]</strong></p>
<p>与时间相关的命令参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-atime</td>
<td>最后访问时间</td>
</tr>
<tr>
<td>-ctime</td>
<td>创建时间</td>
</tr>
<tr>
<td>-mtime</td>
<td>最后修改时间</td>
</tr>
</tbody>
</table>
<p>下面以-mtime参数举例</p>
<blockquote>
<ul>
<li>-mtime n: n 为数字，表示为在n天之前的”一天之内“修改过的文件</li>
<li>-mtime +n: 列出在n天之前（不包含n天本身）被修改过的文件</li>
<li>-mtime -n: 列出在n天之前（包含n天本身）被修改过的文件</li>
<li>newer file: file为一个已存在的文件，列出比file还要新的文件名</li>
</ul>
</blockquote>
<p><img src="https://dn-anything-about-doc.qbox.me/linux_base/5-8.png" alt="时间轴"></p>
<p>列出home目录中，当天（24小时之内）有改动的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ find ~ -mtime 0</div></pre></td></tr></table></figure>
<p>列出比某个文件新的所有文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 姑且利用一下工程师配置环境时遗留的test.c~文件吧-_-||</div><div class="line">$ find ~ newer Documents/test.c\~</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux学习笔记/">Linux学习笔记</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/10/Algorithms-Union-Find/" title="Union-Find" itemprop="url">Union-Find</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2016-01-10T08:30:00.000Z" itemprop="datePublished"> Published 2016-01-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="一、Quick-Find"><a href="#一、Quick-Find" class="headerlink" title="一、Quick-Find"></a>一、Quick-Find</h1><p>##算法思想</p>
<p>将相互连通的节点归类于集合里，每一个集合有自己的集合编号。用连续的数组来储存所有节点，数组的每个元素的内容为所属集合的集合编号（初始值为自己的index）。<br>每次连接（union）两个节点时，将其中一个节点所属的集合中的所有节点的集合号改为另一个节点的集合编号。<br>每次查询（find）两个节点是否已连接时，只需查看两个节点的集合编号是否一致。</p>
<p>##算法效率<br>find快，union慢。union访问数组次数为N，find访问数组次数为1</p>
<h1 id="二、Quick-Union"><a href="#二、Quick-Union" class="headerlink" title="二、Quick-Union"></a>二、Quick-Union</h1><h2 id="算法思想"><a href="#算法思想" class="headerlink" title="算法思想"></a>算法思想</h2><p>利用树结构，用连续数组储存所有的节点，每个数组元素的内容为该节点的父节点（初始值为自己的index）。所以树的root节点的父节点为自己。<br>Union：找到两个节点所在的树的root，并将其中一个节点的root改为另一个节点的root<br>Find：找到两个节点所在的树的root，并对比是否相同。（遍历本节点的父节点的，知道父节点的root与index相同）</p>
<h2 id="算法效率"><a href="#算法效率" class="headerlink" title="算法效率"></a>算法效率</h2><p>Union快，Find慢。union访问数组次数为N，find访问数组次数为N</p>
<h1 id="三、Weighted-quick-union"><a href="#三、Weighted-quick-union" class="headerlink" title="三、Weighted quick-union"></a>三、Weighted quick-union</h1><h2 id="算法思想-1"><a href="#算法思想-1" class="headerlink" title="算法思想"></a>算法思想</h2><p>在quick-union的基础上，改良union的操作。增加一个数组来记录所有节点所在树的深度。union两个节点的时候将树深度浅的节点树深度深的节点的root上，因此可以使形成的树深度较浅，从而减少find和union时遍历树的时间</p>
<h2 id="算法效率-1"><a href="#算法效率-1" class="headerlink" title="算法效率"></a>算法效率</h2><p>find和union都为lgN</p>
<h1 id="四、Quick-Union-Path-Compression"><a href="#四、Quick-Union-Path-Compression" class="headerlink" title="四、Quick-Union+Path-Compression"></a>四、Quick-Union+Path-Compression</h1><h2 id="算法思想-2"><a href="#算法思想-2" class="headerlink" title="算法思想"></a>算法思想</h2><p>在quick-union的基础上，进行路径压缩，即在返回当前节点root函数中，添加id[i]=id[id[i]]，将本节点的父节点改为本节点父节点的父节点，从而达到减小树深的作用。</p>
<h1 id="五、Weighted-quick-union-Path-Compression"><a href="#五、Weighted-quick-union-Path-Compression" class="headerlink" title="五、Weighted quick-union+Path-Compression"></a>五、Weighted quick-union+Path-Compression</h1><h2 id="算法思想-3"><a href="#算法思想-3" class="headerlink" title="算法思想"></a>算法思想</h2><p>在Weighted quick-union的基础上，进行路径压缩。效率最高。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Princeton-Algorithms/">Princeton Algorithms</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/10/my-choice/" title="我为什么这样选择" itemprop="url">我为什么这样选择</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2016-01-09T16:00:00.000Z" itemprop="datePublished"> Published 2016-01-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="程序员-And-黑客"><a href="#程序员-And-黑客" class="headerlink" title="程序员 And 黑客"></a>程序员 And 黑客</h2><p>如果想做一个程序员，我可以现在开始，啃几本编程宝典，从早到晚的码程序。也许一年后，我可以找到一份还过的去的程序员工作，然后继续在实践中练习coding，几年后我会成为一个称职的程序员。</p>
<p>But 我并不想只做一个程序猿。</p>
<p><strong>I want to be a hacker.</strong></p>
<p>在我眼中，黑客是一种比程序员更酷的生物。成为一名黑客要比成为一名程序员难得多，黑客需要懂得不仅仅只是coding，还需要了解整个系统的层次细节。就Web来说，黑客要懂得是整个的Web九层结构，任何一层都有可能是系统漏洞的根源。然而一名黑客，应需要了解每一层，以及每一层之间的神秘联系，方能在任何一个Web系统里面游刃有余的找出问题，想出对策。当然，我指的是白帽子。</p>
<p>我知道很多黑客已经抵挡不住现实中的生活压力，转而做开发。这并不意味着堕落，开发是创造，是从无到有。重要的是，它也其乐无穷。再现实一点说，开发是当前的潮流，是能满足IT人高薪需求的职业。</p>
<p>但，我相信，开发市场终究会有饱和的时候，就像在有限的土地上盖房子一样。</p>
<p>而安全不一样，安全的问题会一直存在，因为永远没有绝对的安全。如果有一个系统还没有被黑掉，只能说明暂时还没有人发现他的漏洞。</p>
<p>coding 是hacking的好伙伴，它是能让hacker随心所欲的好帮手。</p>
<h2 id="技术-Or-学历"><a href="#技术-Or-学历" class="headerlink" title="技术 Or 学历"></a>技术 Or 学历</h2><p>当你不是一个天才的时候，你就需要在这两者之间做抉择了。幸运的是，IT是一个相对公平的行业，只要你有能力，肯努力，一定会有所成。</p>
<p>随着时间积累，慢慢沉淀下来的技术是一个技术人一生最大的财富。</p>
<p>说到这里，不难看出，我已经有了坚定的答案。</p>
<p>所以，我还需要时间，还需要沉淀。</p>
<p>所以，我不得不加入考研大潮。</p>
<p>但我无心追求名校，原因有三：</p>
<blockquote>
<ul>
<li><p>一、只要坚持，无论在哪里，一样能做成想做的事。（主要归功于网络的发达，信息的丰富）</p>
</li>
<li><p>二、我所在的地方并不糟糕，然而我可以努力的争取一个不错的导师。</p>
</li>
<li><p>三、我可以把省下的时间和精力用在做更多我认为有意义的多的东西上。比如，作为一个菜鸟，应该踏踏实实的打好实践的技术基础，而不是仅仅能<strong>考得一手好试</strong>。</p>
</li>
</ul>
</blockquote>
<p>所以我这样选择。</p>
<p>如果时间继续像现在这样，一点一点的证明我选择的正确性，我会就这样坚持下去。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/胡思乱想/">胡思乱想</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/思考/">思考</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/08/ubuntu更换更新源/" title="Ubuntu14.04更换更新源" itemprop="url">Ubuntu14.04更换更新源</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2015-07-08T14:50:38.000Z" itemprop="datePublished"> Published 2015-07-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h1><p>今天给Ubuntu server版安装一个软件，但是获取源的时候却提示我404错误，ping了这个源的IP是通的~这个时候我知道问题又要来了&gt; _ &lt;</p>
<p>问题大概是这个格式的：</p>
<p><img src="http://www.linuxidc.com/upload/2011_07/110716135978771.png" alt="问题描述"></p>
<p>获取源的时候忘了截图。。。盗用一下人家的图哈~</p>
<p>于是，我求助度娘~在看了几个类似的情况之后，我很幸运的找到了一个小白非常容易看懂的解决办法！</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>直接暴力地附上传送门！</p>
<p><a href="http://jingyan.baidu.com/article/925f8cb8f3af25c0dde05681.html" target="_blank" rel="external">Ubuntu 14.04 命令行下更换更新源的方法</a></p>
<p>这位兄台是把更新源全部换成了163的，于是我也默默的都换了163，其他的源估计也是可以的。</p>
<p>OK! 问题解决!</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux中鸡毛蒜皮的配置问题/">Linux中鸡毛蒜皮的配置问题</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/16/build-blog-with-hexo/" title="用Hexo在Github上搭建Blog" itemprop="url">用Hexo在Github上搭建Blog</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2015-04-15T16:00:00.000Z" itemprop="datePublished"> Published 2015-04-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><h3 id="注意安装顺序！"><a href="#注意安装顺序！" class="headerlink" title="注意安装顺序！"></a>注意安装顺序！</h3><p>1.安装Node.js  <a href="https://node.js.org/" target="_blank" rel="external">Node.js下载传送门</a></p>
<p>2.安装Git  <a href="http://git-scm.com/" target="_blank" rel="external">Git下载传送门</a></p>
<h2 id="用Hexo克隆主题"><a href="#用Hexo克隆主题" class="headerlink" title="用Hexo克隆主题"></a>用Hexo克隆主题</h2><h3 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h3><p>打开Git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g hexo</div></pre></td></tr></table></figure>
<h3 id="部署Hexo"><a href="#部署Hexo" class="headerlink" title="部署Hexo"></a>部署Hexo</h3><p>在我的电脑中建立一个名字叫[Hexo]的文件夹，然后再此文件夹中右键打开Git Bash。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ hexo init</div><div class="line">$ npm install</div></pre></td></tr></table></figure>
<p>Hexo随后会自动在目标文件夹中建立网站所需的所有文件。<br>现在我们已经搭建起本地的hexo博客了，执行以下命令(在Hexo文件夹下)，然后到浏览器输入localhost:4000看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ hexo g</div><div class="line">$ hexo s</div></pre></td></tr></table></figure>
<h3 id="复制主题"><a href="#复制主题" class="headerlink" title="复制主题"></a>复制主题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo clean</div><div class="line">$ hexo g</div><div class="line">$ hexo s</div></pre></td></tr></table></figure>
<p>建立了Hexo文件之后复制wuchong的修改的主题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/wuchong/jacman.git themes/jacman</div></pre></td></tr></table></figure>
<h3 id="启用主题"><a href="#启用主题" class="headerlink" title="启用主题"></a>启用主题</h3><p>修改Hexo目录下的config.yml配置文件中的theme属性，将其设置为jacman。（是Hexo根目录下的config.yml）</p>
<blockquote>
<p>theme: jacman</p>
</blockquote>
<h3 id="更新主题"><a href="#更新主题" class="headerlink" title="更新主题"></a>更新主题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> themes/jacman</div><div class="line">$ git pull origin master</div></pre></td></tr></table></figure>
<h2 id="主题的配置"><a href="#主题的配置" class="headerlink" title="主题的配置"></a>主题的配置</h2><p>接下来通过来修改/themes/jacman/config.yml 来配置主题。</p>
<p>主题的作者已经提供了详细的配置说明，<a href="https://github.com/wuchong/
jacman/wiki/配置指南" target="_blank" rel="external">配置文件传送门</a></p>
<p>每次改完配置文件后，输入下面的命令重构本地网站</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git pull origin master</div><div class="line">$ hexo g <span class="comment">#生成</span></div><div class="line">$ hexo s <span class="comment">#启动本地服务，进行文章预览</span></div></pre></td></tr></table></figure>
<p>后两条命令可以用下面的组合命令代替</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo d -g</div></pre></td></tr></table></figure>
<h2 id="将网站部署到Github上"><a href="#将网站部署到Github上" class="headerlink" title="将网站部署到Github上"></a>将网站部署到Github上</h2><h3 id="配置根目录下的-config-yml文件"><a href="#配置根目录下的-config-yml文件" class="headerlink" title="配置根目录下的_config.yml文件"></a>配置根目录下的_config.yml文件</h3><blockquote>
<p>deploy:<br>type: git</p>
<p>repo: repository url.git</p>
<p>(例如，我的repo：<a href="https://github.com/Lazy-Pig/lazy-pig.github.io.git" target="_blank" rel="external">https://github.com/Lazy-Pig/lazy-pig.github.io.git</a>)</p>
<p>branch: master</p>
</blockquote>
<h3 id="执行deploy将网站push到Github上"><a href="#执行deploy将网站push到Github上" class="headerlink" title="执行deploy将网站push到Github上"></a>执行deploy将网站push到Github上</h3><p>之后执行下列指令即可完成部署，注意部署会覆盖掉你之前在版本库中存放的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo clean</div><div class="line">$ hexo generate</div><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>现在访问 username.github.io 就可以看到你的博客啦！</p>
<h2 id="参考博客及相关链接"><a href="#参考博客及相关链接" class="headerlink" title="参考博客及相关链接"></a>参考博客及相关链接</h2><p>1.<a href="http://cnfeat.com/2014/05/10/2014-05-11-how-to-build-a-blog/" target="_blank" rel="external">如何搭建一个独立博客——简明Github Pages与Hexo教程</a></p>
<p>2.<a href="http://hexo.io/" target="_blank" rel="external">Hexo官网</a></p>
<p>3.<a href="https://stackedit.io/editor" target="_blank" rel="external">Markdown的在线编辑网站StackEdit</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/blog/">blog</a><a href="/tags/Github/">Github</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/04/12/simple-website/" title="搭建一个简单的Web服务器" itemprop="url">搭建一个简单的Web服务器</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Judy" target="_blank" itemprop="author">Judy</a>
		
  <p class="article-time">
    <time datetime="2015-04-12T14:50:38.000Z" itemprop="datePublished"> Published 2015-04-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><ul>
<li><p>Ubuntu Desktop 14.04 LTS</p>
</li>
<li><p>Apache2</p>
</li>
<li><p>MySQL</p>
</li>
<li><p>PHP</p>
</li>
</ul>
<h2 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h2><h3 id="ubuntu下Apache2的安装与启动"><a href="#ubuntu下Apache2的安装与启动" class="headerlink" title="ubuntu下Apache2的安装与启动"></a>ubuntu下Apache2的安装与启动</h3><p>安装Apache2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install apache2</div></pre></td></tr></table></figure>
<p>重启Apache2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo /etc/init.d/apache2 restart</div></pre></td></tr></table></figure>
<p>重启时系统提示错误信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">apache2: Could not reliably determine the server<span class="string">'s fully</span></div><div class="line">qualified domain name,using 127.0.1.1 for ServerName</div></pre></td></tr></table></figure>
<p>看来是Apache的配置有问题，需要做一点小修改。<br>Ubuntu下的Apache配置文件在： /etc/apache2/apache2.conf</p>
<p>解决方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo gedit /etc/apache2/apache2.conf</div></pre></td></tr></table></figure>
<p>在文件后面加上:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Server Name</span></div><div class="line">ServerName 127.0.0.1</div></pre></td></tr></table></figure>
<p>再执行重启Apache命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo /etc/init.d/apache2 restart</div></pre></td></tr></table></figure>
<p>查看port80是否已经监听：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ netstat -tulnp | grep <span class="string">'80'</span></div></pre></td></tr></table></figure>
<p>显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tcp6       0      0 :::80                   :::*                    LISTEN      4916/apache2</div></pre></td></tr></table></figure>
<p>证明apache2已经正常启动，port 80已经处于监听状态</p>
<p>###打开浏览器进行测试</p>
<p>此时，在Web服务器本机浏览器输入127.0.0.1已经可以看到apache的默认网页。<br>另外，如果你的Web服务器架设在内网，链接上内网的所有设备（智能机、电脑、pad等），它们的浏览器输入你的服务器IP也可以正常访问你的网站。<br>我的网站就架设在家里的局域网内部，IP：192.168.1.X</p>
<h3 id="网站的对外开放"><a href="#网站的对外开放" class="headerlink" title="网站的对外开放"></a>网站的对外开放</h3><p>想要这个局域网内的网站外部也能访问很简单，只要进入家里路由器的设置界面，做一个“端口映射”设置就好。</p>
<ul>
<li><p>如果你想问“端口映射”是什么鬼的话，我附上度娘的解释：<a href="http://baike.baidu.com/link?url=T6P6BMiT15l6Uh2ckVK8duzjYMbtxg3Ar18ArzcLMKZbxrLpQ9Fpg8CDMd9cj3krw7giUztr1DLSwYxeAZ1gLa" target="_blank" rel="external">什么是端口映射?</a> 还是很通俗易懂的吧！</p>
</li>
<li><p>我的路由器是FAST路由器，设置端口映射的方法在这里：<a href="http://www.192ly.com/router-settings/fast/port-mapping.html" target="_blank" rel="external">FAST路由器设置端口映射</a></p>
</li>
<li><p>这时，外部网络浏览器输入宽带拨号获得的IP（在路由器设置界面的首页，运行状态中，WAN口状态里可以看到PPPoE拨号得到的IP）就可以访问你的网站啦！</p>
</li>
<li><p>另外如果你想要用一个域名而不是IP地址访问你的网站的话，需要注册域名，no-ip网站也可以申请免费的动态域名，安装动态域名解析软件（貌似很多人用的花生壳）。（我没有搞域名，对我来说无所谓，所以这里没有详细说明啦！）</p>
</li>
</ul>
<p>###给网站做实体内容</p>
<p>喜欢前端设计的小伙伴可以 自行设计喜欢的页面。鉴于笔者对Web前端开发不感兴趣，当然，也没有这个天赋，于是用了人家做的模板，黑色泡沫背景，很漂亮。</p>
<p>源代码下载地址:<a href="http://www.html5tricks.com/pure-css3-animated-menu.html" target="_blank" rel="external">一个nice的纯黑泡沫背景首页</a></p>
<p>这里只是一个版面，有兴趣的话可以自己添加网站具体内容（利用前端设计技术，Javascripts,HTML,CSS,DOM等），随便你做个bi格很高的个人blog，或是搞一个经济适用的电商网站，很酷炫哈！！</p>
<h2 id="遗留问题"><a href="#遗留问题" class="headerlink" title="遗留问题"></a>遗留问题</h2><p>如果不把网站架设在局域网内部，也就是Ubuntu直接ADSL拨号上网，此时外部用我拨号获得的IP居然无法访问我的网站？！有知道原因的大神麻烦给我留言！</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/时间沉淀技术/">时间沉淀技术</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/linux/">linux</a><a href="/tags/os/">os</a><a href="/tags/Web/">Web</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/时间沉淀技术/" title="时间沉淀技术">时间沉淀技术<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/胡思乱想/" title="胡思乱想">胡思乱想<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Linux学习笔记/" title="Linux学习笔记">Linux学习笔记<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/思考/" title="思考">思考<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Web/" title="Web">Web<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Github/" title="Github">Github<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MapReduece/" title="MapReduece">MapReduece<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/blog/" title="blog">blog<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Princeton-Algorithms/" title="Princeton Algorithms">Princeton Algorithms<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hadoop/" title="hadoop">hadoop<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/os/" title="os">os<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MapReduce/" title="MapReduce">MapReduce<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MySQL/" title="MySQL">MySQL<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux中鸡毛蒜皮的配置问题/" title="Linux中鸡毛蒜皮的配置问题">Linux中鸡毛蒜皮的配置问题<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> Hello ,I&#39;m Lazy Judy. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/http://weibo.com/u/2431107805/" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Judy">Judy</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
